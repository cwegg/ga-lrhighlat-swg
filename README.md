# ga-lrhighlat-swg

When you clone make sure you get the submodules containing the mos/ifu workflow too i.e. clone using `git clone --recursive https://github.com/cwegg/ga-lrhighlat-swg.git` or similar.  Probably you also want to download the current catalogues using `dvc pull`. For this step you need access to the the Cambridge server.

Then if you run ```dvc repro``` you should automatically generate all the OBs from the catalogues in a reproduceable way! Because configuring fields typically takes >10 minutes per field, you almost certainly want to run on a cluster e.g. the [herts cluster](https://uhhpc.herts.ac.uk/wiki/index.php/WEAVE).

You will need a recent version of DVC (>=1.11.8). Because the weave workflow currently has relative imports, will first need to add weaveworkflow and weaveworkflow/ifu to you pythonpath i.e.`export PYTHONPATH=[this directory]:[this directory]/weaveworkflow:[this directory]/weaveworkflow/ifu`.

To change things for a new submission or catalogue then edit params.yaml with the details of the catalogue you wish to configure. Then if you run ```dvc repro``` your configured xmls should be created.


As an example from science verification the params are:
```yaml
field_template: 'weaveworkflow/mos/workflow/mos_stage1/aux/mos_field_template.fits' # Don't change this
submission:
  SV_exp1:
    footprint:
      footprint_file: 'data_repo/footprints/exp1_SV.fits' # Your footprint with RA/DEC/FIELDNAME
      surveys:
        targsrvys: ['WS2021A1-028'] # List of TARGSRVY we want to add to this submission. 
        max_fibres: [1000] # This is only relevent if sharing fibres with other fibres. Otherwise leave >=1000.
      progtemp: '11331.1+' # Observation mode - See ICD-30
      obstemp: 'DACEB' # Observing conditions - See ICD-30
      keywords: # Shared that change from submission to submission
        trimester: '2020A1'
        author: 'you@a.com'
        report_verbosity: 1
        cc_report: 'me@b.edu, them@c.eu'
    catalogue_dir: 'catalogues/SV_exp1' # Catalogue location - generated by Sergey
    configure_epoch: '2021.5' # What epoch should configure use (only important for proper motion/parallax) 
    # Source list locations - These must match those Sergey used to generate the catalogues
    external_cats: 'data_repo/external_cats/exp1_SV' 
    internal_cats: 'data_repo/internal_cats/exp1_SV'
```

The directory `catalogues` contains the catalogues generated by Sergey using [this code](https://github.com/segasai/weave_galr), either pre-WASP submission (for testing) or downloaded from the WASP (for actual XML OB submission). These should be stored using DVC for traceability.

The directory `data_repo` should mirror the directory containing the source lists that Sergey used to generate those catalogues. Again these should be stored using DVC for traceability.  
